<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ page.title }}</title>
    {% if page.description %}<meta name="description" content="{{ page.description }}">{% endif %}
    <meta name="author" content="{{ site.author.name }}">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- <link href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700" rel="stylesheet" type="text/css"> -->
    <link href="{{ ASSET_PATH }}/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ ASSET_PATH }}/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="{{ ASSET_PATH }}/css/font.css" rel="stylesheet" type="text/css" media="all">
    <link href="{{ ASSET_PATH }}/css/pygment.css" rel="stylesheet" type="text/css" media="all">
    <style type="text/css">
    code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit; color: inherit;}
    /*body {background: url({{ ASSET_PATH }}/img/bg.png) left top repeat;}*/
    </style>
    <script type="text/javascript" src="{{ ASSET_PATH }}/js/jquery.min.js"></script>
    <script src="{{ ASSET_PATH }}/js/filters.min.js" type="text/javascript"></script>
    <script src="{{ ASSET_PATH }}/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="{{ ASSET_PATH }}/js/jquery.infinitescroll.min.js" type="text/javascript"></script>
    <script src="{{ ASSET_PATH }}/js/jquery.masonry.min.js" type="text/javascript"></script>
    <script src="{{ ASSET_PATH }}/js/jquery.imagesloaded.min.js" type="text/javascript"></script>
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/javascript">
    MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } },
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    });
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
    (function($)
    {
      function init(e) {
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        $("img[alt]",e).each(function(){
          if ($(this).attr("alt").length == 0)
            $(this).removeAttr("alt");
        })
        $("img[alt]",e).wrap("<div class='photo'>")
          .after("<div class='icon'><img src='{{ ASSET_PATH }}/img/info-icon.png'></div>")
          .parent()
          .on("hover", function(){$(this).children(".icon").toggle()});
        $("img[alt]",e).each(function(){
          cameraData = $(this).attr("alt").split(",");
          $(this).siblings(".icon").data("title",["<div class='exif'><div class='camera'><span class='exiflabel'>camera</span>",cameraData[0],"</div><div class='cameraProperty'><span class='exiflabel'>iso</span>",cameraData[1],"</div><div class='cameraProperty'><span class='exiflabel'>aperture</span>",cameraData[2],"</div><div class='cameraProperty'><span class='exiflabel'>exposure</span>",cameraData[3],"</div><div class='cameraProperty'><span class='exiflabel'>focal length</span>",cameraData[4],"</span></div></div>"].join(""));
        });
        $(".photo",e).tooltip({
          selector: ".icon",
          html: true,
          placement: "bottom"
        });
        // lightbox
        $(".post a[href*='/images/']",e).addClass("view");
        $(".post",e).each(function(i){
          $("a.view",this).attr("rel",i);
        })
        var $a = $('a.view[href]',e);
        var sets = {};

        $a.each(function () {
          var r = this.rel;
          if( r ){
            if (!sets[r]) {
              sets[r] = [];
            }
            sets[r].push(this);
          }else{
            new View($(this));
          }
        });
        for (var i in sets) {
          new View($(sets[i]));
        }
        // create mason image gallery
        $(".post",e).each(function(){
          if ($("a.view",this).length > 2)
            $("a.view",this).addClass("masonitem").wrapAll("<div class='mason'>");
        });
        var $container = $('.mason',e);
        $container.imagesLoaded(function(){
          $container.masonry({
            itemSelector : '.masonitem',
            columnWidth : function( containerWidth ) {
              return containerWidth / 2;
            }
          });
        });
      }
      $(document).ready(function(){
        {% if page.title == "dfeng" %}
        $(".posts").infinitescroll({
          loading: {
            msgText: "",
            finished: init,
            finishedMsg: "",
            img: "{{ ASSET_PATH }}/img/spacer.gif"
          },
          nextSelector: "ul.pager a:first",
          navSelector: "ul.pager",
          itemSelector: ".posts div.post"
        });
        {% endif %}
        /*greetings = ["Hi. I'm Derek!", "I love Community!", "More fish for Kunta.", "You can't disappoint a picture."]
        function rand() {
          return(greetings[Math.floor(Math.random() * greetings.length)])
          // return(greetings.pop())
        }
        $('.icon-user').tooltip({
          placement: "left",
          title: rand
        })*/
        init("html");
      });
    })(jQuery);
    </script>
    <script src="{{ ASSET_PATH }}/js/view.min.js" type="text/javascript"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <h1 id="title"><a href="/">{{ site.title }}</a></h1>
        <span id="subtitle">{{ site.tagline }}</span>
        <!-- <div class="flourish"><i class="icon-leaf"></i></div> -->
      </div>
    </header>
    <div class="container"><div class="row-fluid">
      <div id="sidebar" class="span2">
        <ul id="sidebar-icons" data-spy="affix" data-offset-top="100">
          {% for node in site.pages %}
            {% if node.group == 'navigation' %}
              <li><a href="{{ node.url }}"><i class="icon-{{ node.icon }}"></i></a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
      <div id="content" class="span8">
        {{ content }}
      </div>
      <div class="span2"></div>
    </div></div>
    {% include JB/analytics %}
  </body>
</html>
